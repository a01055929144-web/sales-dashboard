<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Sales Store Map Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet & MarkerCluster -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: #f3f4f6;
      color: #111827;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /***********************************************
     * HEADER
     ***********************************************/
    header {
      padding: 10px 16px;
      background: #ffffff;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      align-items: center;
      gap: 12px;
      position: sticky;
      top: 0;
      z-index: 20;
    }
    header h1 { margin: 0; font-size: 18px; font-weight: 700; }

    .header-controls {
      flex: 1;
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .search-input,
    .select-input {
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 6px 12px;
      font-size: 13px;
      outline: none;
      background: #f9fafb;
    }
    .search-input { flex: 1; min-width: 120px; }
    .select-input { min-width: 120px; }

    .required-text {
      color: #dc2626;
      font-weight: 700;
      font-size: 11px;
      margin-left: 4px;
    }

    /***********************************************
     * BUTTONS
     ***********************************************/
    .primary-btn, .secondary-btn {
      border-radius: 12px;
      border: none;
      padding: 10px 14px;
      font-size: 13px;
      cursor: pointer;
      margin-top: 6px;
      width: 100%;
      font-weight: 700;
    }

    .primary-btn {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: white;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.35);
      transition: all .18s ease-out;
    }
    .primary-btn:hover:not(:disabled) {
      background: linear-gradient(135deg, #1e40af, #1e3a8a);
      transform: translateY(-2px);
      box-shadow: 0 6px 14px rgba(30, 64, 175, 0.45);
    }
    .primary-btn:disabled {
      background: #9db4e0 !important;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    /***********************************************
     * MAIN LAYOUT
     ***********************************************/
    .layout {
      flex: 1;
      display: grid;
      grid-template-columns: 280px minmax(0, 1fr) 320px;
      height: calc(100vh - 52px);
      overflow: hidden;
    }

    .store-panel,
    .dashboard-panel {
      background: #ffffff;
      border: 1px solid #e5e7eb;
      padding: 12px;
      overflow-y: auto;
      position: relative;
      z-index: 9999; /* ì§€ë„ë³´ë‹¤ ìœ„ */
    }

    .store-panel { border-right: 1px solid #e5e7eb; }
    .dashboard-panel { border-left: 1px solid #e5e7eb; }

    #map { width: 100%; height: 100%; }

    /***********************************************
     * STORE LIST
     ***********************************************/
    .store-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .store-list-header h2 {
      margin: 0;
      font-size: 14px;
      font-weight: 700;
    }
    .store-count {
      font-size: 11px;
      color: #6b7280;
    }

    .store-sort-row {
      margin-bottom: 8px;
    }

    .store-item {
      padding: 10px;
      border-radius: 10px;
      border: 1px solid transparent;
      cursor: pointer;
      margin-bottom: 6px;
      transition: 0.15s;
      background: #ffffff;
    }
    .store-item:hover {
      background: #f9fafb;
      border-color: #e5e7ff;
      box-shadow: 0 1px 3px rgba(15,23,42,0.12);
    }

    .store-header {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
    }
    .store-name {
      font-size: 13px;
      font-weight: 700;
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .fav-icon {
      cursor: pointer;
      font-size: 16px;
      flex-shrink: 0;
    }
    .store-meta-line {
      display: flex;
      gap: 6px;
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 3px;
    }
    .store-meta-address {
      font-size: 11px;
      color: #374151;
    }

    .status-badge {
      padding: 2px 6px;
      background: #eef2ff;
      border-radius: 999px;
      font-size: 11px;
      color: #4f46e5;
      font-weight: 600;
    }

    /***********************************************
     * DASHBOARD
     ***********************************************/
    .dashboard-title {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .chart-wrapper {
      padding: 10px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      margin-bottom: 10px;
    }

    .stat-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
      margin-bottom: 10px;
    }
    .stat-card {
      background: #ffffff;
      padding: 8px;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
    }
    .stat-label {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 2px;
    }
    .stat-value {
      font-size: 16px;
      font-weight: 700;
    }
    .stat-sub {
      font-size: 11px;
      color: #6b7280;
    }

    .detail-card {
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      background: #f9fafb;
      padding: 10px;
      margin-bottom: 10px;
    }
    .detail-title {
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .detail-name {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .info-item {
      font-size: 12px;
      margin-bottom: 4px;
    }
    .info-item span {
      display: inline-block;
      width: 55px;
      font-weight: 600;
      color: #374151;
    }

    .status-change-box {
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 10px;
      margin-bottom: 10px;
      background: #fafafa;
    }
    .status-change-header {
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    /***********************************************
     * HISTORY TIMELINE
     ***********************************************/
    .history-section {
      margin-top: 10px;
    }
    .history-header{
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .history-empty {
      font-size: 12px;
      color: #9ca3af;
      padding: 6px;
    }
    .history-list {
      font-size: 12px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background: #f9fafb;
      padding: 6px;
      max-height: 160px;
      overflow-y: auto;
      margin-bottom: 6px;
    }

    .timeline-item {
      position: relative;
      padding-left: 18px;
      margin-bottom: 10px;
    }
    .timeline-dot {
      width: 9px;
      height: 9px;
      background: #2563eb;
      border-radius: 999px;
      position: absolute;
      left: 0;
      top: 4px;
    }
    .timeline-date {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 2px;
    }
    .timeline-card {
      background: #ffffff;
      border: 1px solid #e5e7eb;
      padding: 6px 8px;
      border-radius: 8px;
      font-size: 12px;
    }
    .timeline-manager {
      font-size: 11px;
      color: #374151;
      font-weight: 700;
    }
    .timeline-memo {
      margin-top: 3px;
      font-size: 12px;
      color: #111827;
      white-space: pre-wrap;
    }

    textarea#memoInput {
      border: 1px solid #d1d5db;
      border-radius: 8px;
      padding: 8px;
      width: 100%;
      min-height: 48px;
      font-size: 12px;
      resize: vertical;
    }

    /***********************************************
     * MARKER DOT
     ***********************************************/
    .marker-dot {
      border-radius: 999px;
      border: 2px solid #ffffff;
    }

  </style>
<!-- âœ… ëª¨ë°”ì¼ ìµœì í™” ë¯¸ë””ì–´ ì¿¼ë¦¬ + ë§¤ì¥ ë¦¬ìŠ¤íŠ¸ ê³ ì • ìŠ¤í¬ë¡¤ -->
<style>
  
@media screen and (max-width: 768px) {

  /* ğŸ”¥ ëª¨ë°”ì¼ì—ì„œëŠ” body ë†’ì´ë¥¼ ê³ ì •í•˜ì§€ ì•ŠìŒ */
  body {
    height: auto !important;
  }

  /* ğŸ”¥ header í•„í„° ì¤„ë°”ê¿ˆ ê°€ëŠ¥í•˜ë„ë¡ */
  header {
    flex-wrap: wrap !important;
    padding-bottom: 10px;
    height: auto !important;
  }

  .header-controls {
    flex-wrap: wrap !important;
    width: 100%;
    gap: 8px;
  }

  /* ğŸ”¥ í•„í„°/ê²€ìƒ‰ input â†’ 2ì¤„ ìë™ ë°°ì¹˜ */
  .search-input,
  .select-input {
    flex: 1 1 calc(50% - 10px);
    min-width: 140px;
    font-size: 15px;
    padding: 10px;
  }

  /* ğŸ”¥ ì „ì²´ êµ¬ì¡° */
  .layout {
    display: block;
    height: auto !important;
    overflow-y: auto;
    padding-bottom: 0 !important;
    margin-bottom: 0 !important;
  }

  /* ğŸ”¥ ë§¤ì¥ ë¦¬ìŠ¤íŠ¸ */
  .store-panel {
    max-height: 180px;
    overflow-y: auto;
    border-bottom: 1px solid #ddd;
    padding-bottom: 6px;
    margin-bottom: 0 !important;
  }

  /* ğŸ”¥ ì§€ë„ í¬ê¸° - ë¹ˆ ê³µê°„ ì œê±° + í•­ìƒ ê½‰ ì°¨ê²Œ */
  #map {
    width: 100%;
    height: 420px !important;     /* ëª¨ë°”ì¼ì—ì„œ ì±„ìš°ëŠ” ë†’ì´ */
    min-height: 350px !important;
    margin-top: 12px;
  }

  /* ğŸ”¥ ëŒ€ì‹œë³´ë“œ */
  .dashboard-panel {
    margin-top: 14px;
    padding: 12px;
    border: none;
    width: 100%;
    padding-bottom: 0 !important;
    margin-bottom: 0 !important;
  }

  /* ğŸ”¥ ë²„íŠ¼ í¬ê¸° */
  .primary-btn, 
  .secondary-btn {
    width: 100%;
    font-size: 15px;
    padding: 12px;
  }
}




 /* â­ ì¹´ì¹´ì˜¤ë§µ/ë„¤ì´ë²„ ì§€ë„ ìŠ¤íƒ€ì¼ Floating ë²„íŠ¼ */
.floating-location-btn {
  position: fixed;
  bottom: 80px;
  right: 20px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: white;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  border: 1px solid #ddd;

  display: flex;
  justify-content: center;
  align-items: center;

  font-size: 26px;
  cursor: pointer;
  z-index: 9999;

  transition: 0.2s;
}

.floating-location-btn:active {
  transform: scale(0.92);
  box-shadow: 0 2px 6px rgba(0,0,0,0.25);
}
.leaflet-control-locate {
  background: white;
  padding: 8px;
  border-radius: 50%;
  box-shadow: 0 2px 8px rgba(0,0,0,0.25);
  cursor: pointer;
  font-size: 20px;
  line-height: 20px;
  text-align: center;
  width: 42px;
  height: 42px;
  display: flex;
  justify-content: center;
  align-items: center;
}
.leaflet-control-locate:hover {
  box-shadow: 0 3px 12px rgba(0,0,0,0.3);
}
#dashboardContent {
  transition: max-height 0.25s ease-out;
  overflow: hidden;
}

#dashboardFoldArea.dashboard-collapsed {
  max-height: 0 !important;
  opacity: 0;
}

#dashboardFoldArea.dashboard-expanded {
  max-height: 1200px;
  opacity: 1;
}
/* ğŸ”¥ ë“œë¡­ë‹¤ìš´/ì…ë ¥/ë²„íŠ¼ì´ ì§€ë„ ìœ„ì—ì„œ ì •ìƒ ë™ì‘í•˜ë„ë¡ ì´ë²¤íŠ¸ ìš°ì„ ê¶Œ ë¶€ì—¬ */
.dashboard-panel,
.store-panel {
  pointer-events: auto !important;
}


  
</style>
</head>

<body>

<header>
  <h1>ğŸ“ Sales Store Map</h1>

  <div class="header-controls">
  <select id="openMonthSelect" class="select-input">
  <option value="ALL">ì „ì²´ ì˜¤í”ˆì›”</option>
   </select>

    <select id="statusFilterSelect" class="select-input">
      <option value="ALL">ì „ì²´ ìƒíƒœ</option>
    </select>

    <select id="categorySelect" class="select-input">
      <option value="ALL">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
    </select>

    <select id="regionSelect" class="select-input">
      <option value="ALL">ì „ì²´ ì§€ì—­</option>
    </select>

    <input id="searchInput" class="search-input" placeholder="ex) ë§¤ì¥ëª… / ì£¼ì†Œ / í‚¤ì›Œë“œ" />
  </div>  
</header>

<div class="layout">
  <!-- ì¢Œì¸¡ íŒ¨ë„: ë§¤ì¥ ë¦¬ìŠ¤íŠ¸ -->
  <aside class="store-panel" id="storePanel">
    <div class="store-list-header">
      <h2>ğŸ“Œ ë§¤ì¥ ë¦¬ìŠ¤íŠ¸ </h2>
      <span class="store-count" id="storeCountLabel">0ê°œ</span>
    </div>

    <div class="store-sort-row">
      <select id="sortSelect" class="select-input" style="width:100%;">
        <option value="default">ì¦ê²¨ì°¾ê¸° â–· ìƒíƒœ â–· ì´ë¦„</option>
        <option value="name">ì´ë¦„ìˆœ (ê°€ë‚˜ë‹¤)</option>
        <option value="blog">ë¸”ë¡œê·¸ ë§ì€ìˆœ</option>
      </select>
    </div>

    <ul id="storeList" class="store-list" style="list-style:none; padding:0; margin:0;"></ul>
  </aside>

  <!-- ê°€ìš´ë°: ì§€ë„ -->
  <main>
    <div id="map"></div>
  </main>

  <!-- ìš°ì¸¡ íŒ¨ë„: ìƒì„¸ì •ë³´ + ëŒ€ì‹œë³´ë“œ -->
  <aside class="dashboard-panel" id="dashboardPanel">
<div class="dashboard-title" style="display:flex; justify-content:space-between; align-items:center;">
  ğŸ“Š ëŒ€ì‹œë³´ë“œ
  <span id="dashboardToggleBtn" style="cursor:pointer; font-size:16px;">â–¼</span>
</div>

<div id="dashboardContent">
  <!-- ì ‘í˜ START -->
  <div id="dashboardFoldArea">
  <!-- ë„ë„› ì°¨íŠ¸ -->
  <div class="chart-wrapper">
      <canvas id="statusChart"></canvas>
      <div id="chartStats" style="font-size:11px; margin-top:6px; line-height:1.4;"></div>
    </div>

    <!-- ìˆ«ì ì¹´ë“œ -->
    <div class="stat-grid">
      <div class="stat-card">
        <div class="stat-label">ì´ ë§¤ì¥ ìˆ˜</div>
        <div class="stat-value" id="statTotal">0</div>
      </div>
      

      <div class="stat-card">
        <div class="stat-label">ê±°ë˜ ì„±ì‚¬</div>
        <div class="stat-value" id="statDeal">0</div>
        <div class="stat-sub" id="statDealPct"></div>
      </div>

      <div class="stat-card">
        <div class="stat-label">ë¯¸íŒ… ì™„ë£Œ</div>
        <div class="stat-value" id="statMeetingDone">0</div>
        <div class="stat-sub" id="statMeetingDonePct"></div>
      </div>

      <div class="stat-card">
        <div class="stat-label">ë¯¸íŒ… ìš”ì²­</div>
        <div class="stat-value" id="statRequest">0</div>
        <div class="stat-sub" id="statRequestPct"></div>
      </div>

      <div class="stat-card">
        <div class="stat-label">ë¶€ì¬ì¤‘/ë¯¸ì‘ë‹µ</div>
        <div class="stat-value" id="statNoAnswer">0</div>
        <div class="stat-sub" id="statNoAnswerPct"></div>
      </div>

      <div class="stat-card">
        <div class="stat-label">ê±°ì ˆ</div>
        <div class="stat-value" id="statReject">0</div>
        <div class="stat-sub" id="statRejectPct"></div>
      </div>
    </div>
  </div> <!-- dashboardFoldArea --> 
</div> <!-- dashboardContent -->

    <!-- ìƒì„¸ ì •ë³´ -->
    <div class="detail-card">
      <div class="detail-title">ğŸª ë§¤ì¥ ìƒì„¸ì •ë³´</div>
      <div id="storeDetailBody" class="detail-body">
        ë§¤ì¥ì„ ì„ íƒí•˜ë©´ ìƒì„¸ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.
      </div>
    </div>
    
    <!-- ë‹´ë‹¹ ìœ í˜• ì„ íƒ (CALL / SALES) -->
  <div style="margin-bottom:10px;">
    <label style="font-size:13px; font-weight:700;"> êµ¬ë¶„ <span style="color:#dc2626;">*í•„ìˆ˜*</span></label>
  
      <div id="managerTypeButtons" style="display:flex; gap:8px; margin-top:6px;">
    <button type="button" id="btnCall" class="type-btn inactive">Call</button>
    <button type="button" id="btnSales" class="type-btn inactive">Sales</button>
    </div>
  </div>
    
    <!-- ë‹´ë‹¹ì ì„ íƒ -->
    <div class="detail-title">
    <label style="font-size:13px; font-weight:700;"> ë‹´ë‹¹ì <span style="color:#dc2626;">*í•„ìˆ˜*</span></label>
    </div>
 <select id="managerInput" class="select-input" style="width:100%; margin-bottom:10px;">
      <option value="">ë‹´ë‹¹ì ì„ íƒ</option>
      <option value="Zero">Zero</option>
      <option value="Grandal">Grandal</option>
      <option value="Jose">Jose</option>
      <option value="Aimee">Aimee</option>
      <option value="Merry">Merry</option>
    </select>

<style>
.type-btn {
  flex:1;
  padding:10px 0;
  border-radius:8px;
  border:1px solid #d1d5db;
  font-size:13px;
  font-weight:700;
  background:#f9fafb;
  cursor:pointer;
}
.type-btn.active {
  background:#2563eb;
  color:white;
  border-color:#1d4ed8;
  box-shadow:0 2px 8px rgba(37, 99, 235, 0.35);
}
.type-btn.inactive {
  background:#f3f4f6;
  color:#374151;
}
</style>


   

    <!-- ìƒíƒœ ë³€ê²½ -->
    <div class="status-change-box">
      <div class="status-change-header">ìƒíƒœ ë³€ê²½</div>

      <select id="statusChangeSelect" class="select-input" style="width:100%;">
        <option value="">ìƒíƒœ ì„ íƒ</option>
        <option value="ê±°ë˜ ì„±ì‚¬">ê±°ë˜ ì„±ì‚¬</option>
        <option value="ë¯¸íŒ… ì™„ë£Œ">ë¯¸íŒ… ì™„ë£Œ</option>
        <option value="ë¯¸íŒ… ìš”ì²­">ë¯¸íŒ… ìš”ì²­</option>
        <option value="ë¶€ì¬ì¤‘/ë¯¸ì‘ë‹µ">ë¶€ì¬ì¤‘/ë¯¸ì‘ë‹µ</option>
        <option value="ê±°ì ˆ">ê±°ì ˆ</option>
      </select>

      <button id="statusSaveBtn" class="primary-btn" disabled>ìƒíƒœ ë³€ê²½ ì €ì¥</button>
    </div>

    <!-- íˆìŠ¤í† ë¦¬ + ë©”ëª¨ -->
    <div class="history-section">
      <div class="history-header">ğŸ•’ íˆìŠ¤í† ë¦¬</div>

      <div id="historyList" class="history-list">
        ë§¤ì¥ì„ ì„ íƒí•˜ë©´ íˆìŠ¤í† ë¦¬ê°€ í‘œì‹œë©ë‹ˆë‹¤.
      </div>

      <textarea id="memoInput" placeholder="ë©”ëª¨ ì…ë ¥ (ì €ì¥ ì‹œ ì¼ì‹œ ìë™ ê¸°ë¡)"></textarea>
      <button id="memoSaveBtn" class="primary-btn" disabled>ë©”ëª¨ ì €ì¥</button>
    </div>
  </aside>
</div>

<!-- Leaflet Scripts -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

<script>
/*************************************************
 * ğŸ”‘ Apps Script WebApp URL
 *************************************************/
let managerType = "call";

const BASE_URL =
  "https://script.google.com/macros/s/AKfycbzaQi_u74vqBdzg61Q9it4J0NfjM4YyZAuiaJKZZaxY1dtvtKZUav-UkcthtKOizeqE/exec";

/*************************************************
 * ì „ì—­ ë³€ìˆ˜
 *************************************************/
let rawRows = [];
let rawByName = {};
let filteredRows = [];
let markersByName = {};
let markerCluster;
let selectedStoreName = null;

let map;
let chartInstance;

/*************************************************
 * DOM Ready
 *************************************************/
document.addEventListener("DOMContentLoaded", () => {
  initMap();
  initEvents();
  
  setTypeButtonUI();
  
  loadData().then(() => {
   addMyLiveLocation(); // âœ… ë°ì´í„° ë¡œë“œ í›„ ì‹¤í–‰
    
 // ğŸ‘‰ ì—¬ê¸° ì•„ë˜ì— ì¶”ê°€
  const toggleBtn = document.getElementById("dashboardToggleBtn");
  const content = document.getElementById("dashboardFoldArea");

  content.classList.add("dashboard-expanded");

  toggleBtn.addEventListener("click", () => {
    const collapsed = content.classList.contains("dashboard-collapsed");

    if (collapsed) {
      content.classList.remove("dashboard-collapsed");
      content.classList.add("dashboard-expanded");
      toggleBtn.textContent = "â–¼";
    } else {
      content.classList.remove("dashboard-expanded");
      content.classList.add("dashboard-collapsed");
      toggleBtn.textContent = "â–²";
    }    
  });
 });
});
/*************************************************
 * 1) ì§€ë„ ì´ˆê¸°í™”
 *************************************************/
function initMap() {
  map = L.map("map", {
    center: [37.5665, 126.9780],
    zoom: 11,
    zoomControl: true
  });

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: "&copy; OpenStreetMap"
  }).addTo(map);

  markerCluster = L.markerClusterGroup({
    showCoverageOnHover: false,
    maxClusterRadius: 35
  });
  map.addLayer(markerCluster);

  // ğŸ”¥ ì§€ë„ ë‚´ë¶€ì— ë‚´ ìœ„ì¹˜ ë²„íŠ¼ ì¶”ê°€
  const locateControl = L.control({ position: 'bottomright' });

  locateControl.onAdd = function(map) {
    const btn = L.DomUtil.create('div', 'leaflet-control-locate');
    btn.innerHTML = 'ğŸ“';
    btn.onclick = () => moveToMyLocation();
    return btn;
  };

  locateControl.addTo(map);
}
  
// âœ… ì—¬ê¸° ì¶”ê°€
function addMyLiveLocation() {
  if (!navigator.geolocation) {
    console.warn("Geolocation is not supported.");
    return;
  }
  
  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;

      const myMarker = L.circleMarker([lat, lng], {
        radius: 8,
        fillColor: "#3b82f6",
        color: "#ffffff",
        weight: 2,
        opacity: 1,
        fillOpacity: 0.8
      }).addTo(map);

      myMarker.bindTooltip("ğŸ“ë‚´ ìœ„ì¹˜", { permanent: false });

      map.setView([lat, lng], 14); // ì§€ë„ ì¤‘ì‹¬ ì´ë™
    },
    (err) => {
      console.warn("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", err);
    },
    {
      enableHighAccuracy: true,
      timeout: 10000,
      maximumAge: 0
    }
  );
}
// "ë‚´ ìœ„ì¹˜" ë²„íŠ¼ ëˆŒë €ì„ ë•Œ ì§€ë„ë§Œ ì´ë™ì‹œí‚¤ëŠ” í•¨ìˆ˜
function moveToMyLocation() {
  if (!navigator.geolocation) {
    alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;
      map.setView([lat, lng], 14); // ğŸ”¥ í˜„ì¬ ìœ„ì¹˜ë¡œ ì¬ì´ë™
    },
    (err) => {
      console.error("ìœ„ì¹˜ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨", err);
      alert("í˜„ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    },
    {
      enableHighAccuracy: true,
      timeout: 10000,
      maximumAge: 0
    }
  );
}
  

/*************************************************
 * 2) ì´ë²¤íŠ¸ ë“±ë¡
 *************************************************/
function initEvents() {
  document.getElementById("searchInput").addEventListener("input", applyFilters);
  document.getElementById("categorySelect").addEventListener("change", applyFilters);
  document.getElementById("statusFilterSelect").addEventListener("change", applyFilters);
  document.getElementById("regionSelect").addEventListener("change", applyFilters);
  document.getElementById("sortSelect").addEventListener("change", applyFilters);
  document.getElementById("openMonthSelect").addEventListener("change", applyFilters);
  document.getElementById("statusSaveBtn").addEventListener("click", saveStatus);
  document.getElementById("memoSaveBtn").addEventListener("click", saveMemo);

  // ë‹´ë‹¹ì ì„ íƒ â†’ í•„ìˆ˜ê°’ + ìë™ ê¸°ë¡
  const managerSelect = document.getElementById("managerInput");
  managerSelect.addEventListener("change", () => {
    const manager = managerSelect.value;
    const hasManager = manager !== "";

    document.getElementById("statusSaveBtn").disabled = !hasManager;
    document.getElementById("memoSaveBtn").disabled = !hasManager;

    if (selectedStoreName && hasManager) {
      addManagerHistory(manager);
    }
  });
}

// CALL ë²„íŠ¼
document.getElementById("btnCall").addEventListener("click", () => {
  managerType = "call";
  setTypeButtonUI();
  applyManagerByType();   // â† ğŸ”¥ NEW

});

// SALES ë²„íŠ¼
document.getElementById("btnSales").addEventListener("click", () => {
  managerType = "sales";
  setTypeButtonUI();
  applyManagerByType();   // â† ğŸ”¥ NEW

});

// ë²„íŠ¼ UI ì ìš©
function setTypeButtonUI() {
  const btnCall = document.getElementById("btnCall");
  const btnSales = document.getElementById("btnSales");

  btnCall.classList.toggle("active", managerType === "call");
  btnSales.classList.toggle("active", managerType === "sales");

  btnCall.classList.toggle("inactive", managerType !== "call");
  btnSales.classList.toggle("inactive", managerType !== "sales");
}


/*************************************************
 * 3) ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
 *************************************************/
async function loadData() {
  try {
    const res = await fetch(`${BASE_URL}?action=places`);
    const json = await res.json();

    rawRows = json
      .filter(r => r.lat && r.lng)
      .map(r => ({
        ...r,
        lat: Number(r.lat),
        lng: Number(r.lng),
        favorite: r.favorite === true || r.favorite === "TRUE"
      }));

    rawByName = {};
    rawRows.forEach(r => {
      if (r.name) rawByName[r.name] = r;
    });

    buildFilters(rawRows);
    applyFilters();

    return true;   // ğŸ”¥ ì¶”ê°€: then() ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡
  } catch (e) {
    alert("ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨!");
    console.error(e);
    return false;
  }
}


/*************************************************
 * 4) í•„í„° UI êµ¬ì„±
 *************************************************/
function buildFilters(rows) {
  const catSet = new Set();
  const statusSet = new Set();
  const regionSet = new Set();
  const openMonthSet = new Set();

  rows.forEach(r => {
    if (r.category) catSet.add(r.category.split(">")[0].trim());
    if (r.Status) statusSet.add(r.Status);
    if (r.sigungu) regionSet.add(r.sigungu);
    if (r.open_month && r.open_month.trim()) openMonthSet.add(r.open_month);
  });

  fillSelect("categorySelect", "ì „ì²´ ì¹´í…Œê³ ë¦¬", [...catSet]);
  fillSelect("statusFilterSelect", "ì „ì²´ ìƒíƒœ", [...statusSet]);
  fillSelect("regionSelect", "ì „ì²´ ì§€ì—­", [...regionSet]);

  // ğŸ”¥ ì—¬ê¸° ë¶€ë¶„ë§Œ ìƒˆë¡œ ì¶”ê°€ (ì‹ ê·œ ìš”ì²­ ê¸°ëŠ¥)
  const openMonthSelect = document.getElementById("openMonthSelect");
  openMonthSelect.innerHTML = `
    <option value="ALL">ì „ì²´ ë§¤ì¥</option>
    <option value="ALL_NEW">ì „ì²´ ì‹ ê·œ ë§¤ì¥</option>
    
  `;

  [...openMonthSet].sort().forEach(v => {
    openMonthSelect.insertAdjacentHTML("beforeend",
      `<option value="${v}">${v}</option>`
    );
  });
}




function fillSelect(id, label, arr) {
  const el = document.getElementById(id);
  el.innerHTML = `<option value="ALL">${label}</option>`;
  arr.sort().forEach(v =>
    el.insertAdjacentHTML("beforeend", `<option value="${v}">${v}</option>`)
  );
}

/*************************************************
 * 5) í•„í„° ì ìš©
 *************************************************/
function applyFilters() {
  const q = document.getElementById("searchInput").value.toLowerCase();
  const cat = document.getElementById("categorySelect").value;
  const st = document.getElementById("statusFilterSelect").value;
  const region = document.getElementById("regionSelect").value;
  const sortMode = document.getElementById("sortSelect").value;
  const openMonth = document.getElementById("openMonthSelect").value;

  filteredRows = rawRows.filter(r => {
    const text = `${r.name} ${r.sigungu} ${r.roadAddress} ${r.keyword}`.toLowerCase();
    const major = (r.category || "").split(">")[0].trim();

    const matchSearch = !q || text.includes(q);
    const matchCat = cat === "ALL" || major === cat;
    const matchStatus = st === "ALL" || (r.Status || "") === st;
    const matchRegion = region === "ALL" || (r.sigungu || "") === region;
    const matchOpenMonth =
  (openMonth === "ALL") ||
  (openMonth === "ALL_NEW" && (r.open_month && r.open_month !== "")) ||
  (openMonth !== "ALL_NEW" && String(r.open_month || "") === openMonth);

    return (
      matchSearch &&
      matchCat &&
      matchStatus &&
      matchRegion &&
      matchOpenMonth
    );
  });

  filteredRows = sortStores(filteredRows, sortMode);
  renderAll();
}



/*************************************************
 * 6) ì •ë ¬
 *************************************************/
function sortStores(list, mode) {
  const copy = [...list];

  if (mode === "name") {
    return copy.sort((a, b) =>
      (a.name || "").localeCompare(b.name || "", "ko")
    );
  }

  if (mode === "blog") {
    return copy.sort((a, b) => {
      const ba = Number(b.blog_count || 0);
      const aa = Number(a.blog_count || 0);
      if (ba !== aa) return ba - aa;
      return (a.name || "").localeCompare(b.name || "", "ko");
    });
  }

  // default: ì¦ê²¨ì°¾ê¸° â†’ ìƒíƒœ â†’ ì´ë¦„
  return copy.sort((a, b) => {
    if (a.favorite !== b.favorite) return a.favorite ? -1 : 1;
    const sa = a.Status || "";
    const sb = b.Status || "";
    if (sa !== sb) return sa.localeCompare(sb, "ko");
    return (a.name || "").localeCompare(b.name || "", "ko");
  });
}

/*************************************************
 * 7) ì „ì²´ ë Œë”ë§
 *************************************************/
function renderAll() {
  renderMarkers();
  renderStoreList();
  renderStats();
}

/*************************************************
 * 8) ë§ˆì»¤ ì•„ì´ì½˜
 *************************************************/
function createMarkerIcon(store, favorite = false, selected = false) {

  // ğŸ”¥ ì‹ ê·œ ë§¤ì¥ ìƒ‰ìƒ ìš°ì„  ì ìš©
  const isNew = store.open_month && store.open_month !== "";
  if (isNew) {
    const size = selected ? 22 : 16;
    return L.divIcon({
      className: "custom-marker",
      html: `
        <div class="marker-dot"
             style="
                background:#8b5cf6; /* ë³´ë¼ìƒ‰ */
                border-color:${favorite ? "#fbbf24" : "#ffffff"};
                width:${size}px;
                height:${size}px;
             ">
        </div>`,
      iconSize: [size + 4, size + 4],
      iconAnchor: [(size + 4) / 2, (size + 4) / 2]
    });
  }

  // ê¸°ì¡´ ìƒíƒœ ìƒ‰ìƒ ë¡œì§
  const STATUS_COLOR = {
    "ê±°ë˜ ì„±ì‚¬": "#2ecc71",
    "ë¯¸íŒ… ì™„ë£Œ": "#3498db",
    "ë¯¸íŒ… ìš”ì²­": "#f1c40f",
    "ë¶€ì¬ì¤‘/ë¯¸ì‘ë‹µ": "#95a5a6",
    "ê±°ì ˆ": "#e74c3c"
  };

  const color = STATUS_COLOR[store.Status] || "#7f8c8d";
  const size = selected ? 22 : 16;
  const borderColor = favorite ? "#fbbf24" : "#ffffff";

  return L.divIcon({
    className: "custom-marker",
    html: `
      <div class="marker-dot"
           style="
              background:${color};
              border-color:${borderColor};
              width:${size}px;
              height:${size}px;
           "></div>`,
    iconSize: [size + 4, size + 4],
    iconAnchor: [(size + 4) / 2, (size + 4) / 2]
  });
}

/*************************************************
 * 9) ë§ˆì»¤ ë Œë”ë§
 *************************************************/
function renderMarkers() {
  markerCluster.clearLayers();
  markersByName = {};

  filteredRows.forEach(store => {
    const marker = L.marker([store.lat, store.lng], {
    icon: createMarkerIcon(store, store.favorite, store.name === selectedStoreName)
    });

    marker.bindTooltip(store.name || "", {
      permanent: false,
      direction: "top",
      offset: [0, -8]
    });

    marker.on("click", () => focusOnStore(store));

    markerCluster.addLayer(marker);
    markersByName[store.name] = marker;
  });

  document.getElementById("storeCountLabel").textContent =
    `${filteredRows.length.toLocaleString()}ê°œ ë§¤ì¥`;

  if (filteredRows.length > 0) {
    const group = L.featureGroup(markerCluster.getLayers());
    map.fitBounds(group.getBounds().pad(0.15));
  }
}

/*************************************************
 * 10) ë§¤ì¥ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
 *************************************************/
function renderStoreList() {
  const listEl = document.getElementById("storeList");
  listEl.innerHTML = "";

  filteredRows.slice(0, 500).forEach(store => {
    const isNew = store.open_month && store.open_month !== "";  // â† ì—¬ê¸°!

    const li = document.createElement("li");
    li.className = "store-item";

    const major = (store.category || "").split(">")[0] || "-";

    li.innerHTML = `
      <div class="store-header">
        <div class="store-name">${store.name || "ë§¤ì¥ëª… ì—†ìŒ"}</div>
      </div>
      <div class="store-meta-line">
        <span class="status-badge">${store.Status || "ìƒíƒœ ì—†ìŒ"}</span>
        <span class="meta-text">${store.sigungu || ""} Â· ${major}</span>
      </div>
      <div class="store-meta-address">${store.roadAddress || ""}</div>
    `;

    li.addEventListener("click", () => focusOnStore(store));


    listEl.appendChild(li);
  });
}

/*************************************************
 * 11) ë§¤ì¥ ì„ íƒ
 *************************************************/
function focusOnStore(store) {
  selectedStoreName = store.name;

  if (!isNaN(store.lat) && !isNaN(store.lng)) {
    map.setView([store.lat, store.lng], 17);
  }

  Object.keys(markersByName).forEach(name => {
   const row = rawByName[name];
   markersByName[name].setIcon(
    createMarkerIcon(row, row.favorite, name === selectedStoreName)
  );
});


  showStoreDetail(store);
  setStatusDropdown(store);
  loadHistory(store.name);

  // ğŸ”¥ ë‹´ë‹¹ì ìë™ ì„¸íŒ… (ë‹´ë‹¹ìœ í˜• ê¸°ì¤€)
  applyManagerByType();
}
/*************************************************
 * ğŸ”¥ ë‹´ë‹¹ì ìë™ ë³€ê²½ í•¨ìˆ˜
 *************************************************/
function applyManagerByType() {
  if (!selectedStoreName) return;

  const row = rawByName[selectedStoreName];
  const mgrSelect = document.getElementById("managerInput");

  // ê¸°ë³¸ê°’ ì´ˆê¸°í™”
  mgrSelect.value = "";

  if (managerType === "call" && row["Manager(Call)"]) {
    mgrSelect.value = row["Manager(Call)"];
  }
  if (managerType === "sales" && row["Manager(Sales)"]) {
    mgrSelect.value = row["Manager(Sales)"];
  }
  mgrSelect.dispatchEvent(new Event("change"));
}
/*************************************************
 * 12) ìƒì„¸ì •ë³´ í‘œì‹œ
 *************************************************/
function showStoreDetail(r) {
  const box = document.getElementById("storeDetailBody");
  if (!r) {
    box.textContent = "ë§¤ì¥ì„ ì„ íƒí•˜ë©´ ìƒì„¸ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.";
    return;
  }

  const major = (r.category || "").split(">")[0] || "-";

  let url = r.URL || r.url || "";
  if (url && !/^https?:\/\//i.test(url)) url = "https://" + url;

  const urlHtml = url
    ? `<a href="${url}" target="_blank" style="color:#2563eb;font-weight:600;">ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ì—´ê¸°</a>`
    : "-";

  box.innerHTML = `
    <div class="detail-name">${r.name || ""}</div>
    <div class="info-item"><span>ğŸ  ì£¼ì†Œ</span>${r.roadAddress || "-"}</div>
    <div class="info-item"><span>ğŸ“ ì§€ì—­</span>${r.sigungu || "-"}</div>
    <div class="info-item"><span>ğŸ½ ì—…ì¢…</span>${major}</div>
    <div class="info-item"><span>â­ ìƒíƒœ</span>${r.Status || "-"}</div>
    <div class="info-item"><span>ğŸ“ í‚¤ì›Œë“œ</span>${r.keyword || "-"}</div>
    <div class="info-item"><span>ğŸ”— ë§í¬</span>${urlHtml}</div>
  `;
}

/*************************************************
 * 13) ìƒíƒœ ë“œë¡­ë‹¤ìš´ ê°’ ì„¸íŒ…
 *************************************************/
function saveStatus() {
  if (!selectedStoreName) return alert("ë§¤ì¥ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.");

  const manager = document.getElementById("managerInput").value.trim();
  if (!manager) return alert("ë‹´ë‹¹ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
  if (!managerType) return alert("ë‹´ë‹¹ ìœ í˜•(Call/Sales)ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");

  const newStatus = document.getElementById("statusChangeSelect").value;
  if (!newStatus) return alert("ìƒíƒœë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");

  const memoText = `ìƒíƒœë¥¼ '${newStatus}'ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.`;

  // ğŸ”¥ UIì— ë¨¼ì € ë°˜ì˜
  insertHistoryUI(
    new Date().toLocaleString("ko-KR"),
    manager,
    memoText
  );

  // ğŸ”¥ ì„œë²„ ì €ì¥ (updateStatusë§Œ í˜¸ì¶œ)
  const qs = new URLSearchParams({
    action: "updateStatus",
    name: selectedStoreName,
    status: newStatus,
    manager: manager,
    managerType: managerType
  });

  fetch(`${BASE_URL}?${qs.toString()}`)
    .then(() => applyFilters());
}



/*************************************************
 * 15) íˆìŠ¤í† ë¦¬ ë¡œë”©
 *************************************************/
function loadHistory(name) {
  const listEl = document.getElementById("historyList");
  listEl.innerHTML = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";

  fetch(`${BASE_URL}?action=history&name=${encodeURIComponent(name)}`)
    .then(res => res.json())
    .then(items => {
      if (!Array.isArray(items) || items.length === 0) {
        listEl.innerHTML = `<div class="history-empty">íˆìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
        return;
      }

      listEl.innerHTML = items
        .map(it => `
          <div class="timeline-item">
            <div class="timeline-dot"></div>
            <div class="timeline-date">${it.date}</div>
            <div class="timeline-card">
              <div class="timeline-manager">${it.manager || "-"}</div>
              <div class="timeline-memo">${it.memo || ""}</div>
            </div>
          </div>
        `)
        .join("");
    })
    .catch(() => {
      listEl.innerHTML = `<div class="history-empty">íˆìŠ¤í† ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>`;
    });
}

/*************************************************
 * 16) ë©”ëª¨ ì €ì¥
 *************************************************/
function saveMemo() {
  if (!selectedStoreName) return alert("ë§¤ì¥ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.");

  const manager = document.getElementById("managerInput").value.trim();
  if (!manager) return alert("ë‹´ë‹¹ìë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.");

  const memo = document.getElementById("memoInput").value.trim();
  if (!memo) return alert("ë©”ëª¨ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");

  const now = new Date().toLocaleString("ko-KR");

  insertHistoryUI(now, manager, memo);

  fetch(`${BASE_URL}?action=addMemo&name=${encodeURIComponent(selectedStoreName)}&memo=${encodeURIComponent(memo)}&manager=${encodeURIComponent(manager)}`);

  document.getElementById("memoInput").value = "";
}

/*************************************************
 * 17) ì¦ê²¨ì°¾ê¸°
 *************************************************/
function toggleFavorite(store) {
  store.favorite = !store.favorite;
  if (rawByName[store.name]) {
    rawByName[store.name].favorite = store.favorite;
  }
  applyFilters();

  fetch(`${BASE_URL}?action=favorite&name=${encodeURIComponent(store.name)}&fav=${store.favorite ? "TRUE" : "FALSE"}`);
}

/*************************************************
 * 18) ë‹´ë‹¹ì ìë™ íˆìŠ¤í† ë¦¬ ê¸°ë¡
 *************************************************/
function addManagerHistory(manager) {
  // ğŸ”¥ ë‹´ë‹¹ì ë³€ê²½ ì‹œ íˆìŠ¤í† ë¦¬ë¥¼ ë‚¨ê¸°ì§€ ì•ŠìŒ
  return;
}

/*************************************************
 * ğŸ”¥ ê³µí†µ íˆìŠ¤í† ë¦¬ UI ì‚½ì… í•¨ìˆ˜
 *************************************************/
function insertHistoryUI(date, manager, memo) {
  const listEl = document.getElementById("historyList");

  listEl.insertAdjacentHTML(
    "afterbegin",
    `
      <div class="timeline-item">
        <div class="timeline-dot"></div>
        <div class="timeline-date">${date}</div>
        <div class="timeline-card">
          <div class="timeline-manager">${manager}</div>
          <div class="timeline-memo">${memo}</div>
        </div>
      </div>
    `
  );
}

/*************************************************
 * 19) í†µê³„/ì°¨íŠ¸
 *************************************************/
function renderStats() {
  const stats = {
    total: filteredRows.length,
    deal: 0,
    meetingDone: 0,
    request: 0,
    noAnswer: 0,
    reject: 0
  };

  filteredRows.forEach(r => {
    if (r.Status === "ê±°ë˜ ì„±ì‚¬") stats.deal++;
    else if (r.Status === "ë¯¸íŒ… ì™„ë£Œ") stats.meetingDone++;
    else if (r.Status === "ë¯¸íŒ… ìš”ì²­") stats.request++;
    else if (r.Status === "ë¶€ì¬ì¤‘/ë¯¸ì‘ë‹µ") stats.noAnswer++;
    else if (r.Status === "ê±°ì ˆ") stats.reject++;
  });

  const total = stats.total || 1;
  const pct = v => ((v / total) * 100).toFixed(1);

  document.getElementById("statTotal").textContent = stats.total.toLocaleString();
  document.getElementById("statDeal").textContent = stats.deal.toLocaleString();
  document.getElementById("statMeetingDone").textContent = stats.meetingDone.toLocaleString();
  document.getElementById("statRequest").textContent = stats.request.toLocaleString();
  document.getElementById("statNoAnswer").textContent = stats.noAnswer.toLocaleString();
  document.getElementById("statReject").textContent = stats.reject.toLocaleString();

  document.getElementById("statDealPct").textContent = `${pct(stats.deal)}%`;
  document.getElementById("statMeetingDonePct").textContent = `${pct(stats.meetingDone)}%`;
  document.getElementById("statRequestPct").textContent = `${pct(stats.request)}%`;
  document.getElementById("statNoAnswerPct").textContent = `${pct(stats.noAnswer)}%`;
  document.getElementById("statRejectPct").textContent = `${pct(stats.reject)}%`;

  if (chartInstance) chartInstance.destroy();

  const ctx = document.getElementById("statusChart");
  chartInstance = new Chart(ctx, {
    type: "doughnut",
    data: {
      labels: ["ê±°ë˜ ì„±ì‚¬", "ë¯¸íŒ… ì™„ë£Œ", "ë¯¸íŒ… ìš”ì²­", "ë¶€ì¬ì¤‘/ë¯¸ì‘ë‹µ", "ê±°ì ˆ"],
      datasets: [{
        data: [
          stats.deal,
          stats.meetingDone,
          stats.request,
          stats.noAnswer,
          stats.reject
        ],
        backgroundColor: ["#2ecc71", "#3498db", "#f1c40f", "#95a5a6", "#e74c3c"]
      }]
    },
    options: {
      cutout: "65%",
      plugins: {
        legend: { position: "bottom" }
      }
    }
  });

  document.getElementById("chartStats").innerHTML = `
    <div><b>ê±°ë˜ ì„±ì‚¬:</b> ${stats.deal}ê°œ (${pct(stats.deal)}%)</div>
    <div><b>ë¯¸íŒ… ì™„ë£Œ:</b> ${stats.meetingDone}ê°œ (${pct(stats.meetingDone)}%)</div>
    <div><b>ë¯¸íŒ… ìš”ì²­:</b> ${stats.request}ê°œ (${pct(stats.request)}%)</div>
    <div><b>ë¶€ì¬ì¤‘/ë¯¸ì‘ë‹µ:</b> ${stats.noAnswer}ê°œ (${pct(stats.noAnswer)}%)</div>
    <div><b>ê±°ì ˆ:</b> ${stats.reject}ê°œ (${pct(stats.reject)}%)</div>
  `;
}
</script>



</body>
</html>
