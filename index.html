<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sales Store Map Dashboard</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
    body { margin: 0; font-family: Arial, sans-serif; }
    #map { width: 100%; height: 70vh; }
    #store-list { padding: 20px; }
    .store-item { margin-bottom: 6px; }
    h2 { margin: 20px; }
</style>
</head>

<body>
<h2>ğŸ“Œ Sales Store Map Dashboard</h2>
<div id="map"></div>
<div id="store-list"><b>â­ ë§¤ì¥ ë¦¬ìŠ¤íŠ¸</b><br><br></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// â­ Apps Script API URL
const API_URL =
 "https://script.google.com/macros/s/AKfycbyLPa-oF57-XqHkz3Lkz9KZ0PzHQxhEIcQKkSXJErEPC5rm090eUvCLzr0KUDjP_QHK/exec?action=places";

// ì§€ë„ ì´ˆê¸°í™” (ì„œìš¸ ì¤‘ì‹¬)
const map = L.map('map').setView([37.5665, 126.9780], 12);

// OpenStreetMap íƒ€ì¼ (ë¬´ë£Œ)
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: 'Â© OpenStreetMap'
}).addTo(map);

// -----------------------------------------------------
// ë°ì´í„° ë¡œë“œ
// -----------------------------------------------------
async function loadData() {
    try {
        const res = await fetch(API_URL);
        const rows = await res.json();

        console.log("ğŸ“Œ ë¶ˆëŸ¬ì˜¨ ë°ì´í„°:", rows);

        renderList(rows);
        renderMarkers(rows);

    } catch (err) {
        console.error("API ì˜¤ë¥˜:", err);
        alert("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨!");
    }
}

// -----------------------------------------------------
// ë§¤ì¥ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
// -----------------------------------------------------
function renderList(rows) {
    const box = document.getElementById("store-list");
    box.innerHTML = "<b>â­ ë§¤ì¥ ë¦¬ìŠ¤íŠ¸</b><br><br>";

    rows.forEach(r => {
        box.innerHTML += `<div class="store-item">ğŸ“ ${r.name || "ì´ë¦„ ì—†ìŒ"}</div>`;
    });
}

// -----------------------------------------------------
// ì§€ë„ ë§ˆì»¤ í‘œì‹œ
// -----------------------------------------------------
function renderMarkers(rows) {
    rows.forEach(r => {
        const lat = Number(r.lat);
        const lng = Number(r.lng);

        // ìœ„ë„/ê²½ë„ ì—†ìœ¼ë©´ ê±´ë„ˆë›°ê¸°
        if (isNaN(lat) || isNaN(lng)) {
            console.warn("â— ìœ„ê²½ë„ ì—†ìŒ â†’ ìŠ¤í‚µ:", r);
            return;
        }

        const marker = L.marker([lat, lng]).addTo(map);
        marker.bindPopup(`<b>${r.name || "ë§¤ì¥"}</b>`);
    });
}

// ìµœì´ˆ ì‹¤í–‰
loadData();
</script>

</body>
</html>
